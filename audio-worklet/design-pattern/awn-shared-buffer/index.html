<!DOCTYPE html>
<html>
<head>
  <title>AudioWorkletNode with SharedArrayBuffer | Examples | WebAudio + WASM
    </title>
</head>
<body>
  <a href="../index.html">Example Index</a>
  <h1>AudioWorkletNode with SharedArrayBuffer</h1>
  <button id="start-audio">Start Audio</button>
  <script src="shared-buffer-worklet-node.js"></script>
  <script>
    const context = new AudioContext();
    const audioWorker = new Worker('audio-worker.js');
    const eButton = document.getElementById('start-audio');

    context
        .audioWorklet.addModule('shared-buffer-worklet-processor.js')
        .then(startDemo);

    function startDemo() {
      let osc = new OscillatorNode(context);
      let sbwNode = new SharedBufferWorkletNode(context);

      sbwNode.onInitialized = () => {
        context.suspend();
        osc.connect(sbwNode).connect(context.destination);
        osc.start();
        eButton.disabled = false;
      };

      // For simple toggle mechanism.
      eButton.disabled = true;
      eButton.onclick = () => {
        if (eButton.textContent === 'Start Audio') {
          context.resume();
          eButton.textContent = 'Stop Audio';
        } else {
          context.suspend();
          eButton.textContent = 'Start Audio';
        }
      };
    }
  </script>
</body>
</html>
